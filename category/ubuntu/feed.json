{
    "version": "https://jsonfeed.org/version/1",
    "title": "MAXshiro • All posts by \"ubuntu\" category",
    "description": "Discover and Record the world.",
    "home_page_url": "http://maxshiroi.top",
    "items": [
        {
            "id": "http://maxshiroi.top/linux/ubuntu/112140/",
            "url": "http://maxshiroi.top/linux/ubuntu/112140/",
            "title": "在MariaDB中设置主从复制",
            "date_published": "2023-05-23T03:21:40.000Z",
            "content_html": "<p>本文将介绍如何在 MariaDB 中设置主从复制。主从复制是一种数据库复制技术，其中一个数据库服务器（称为 “主服务器”）将其更改传递给一个或多个其他数据库服务器（称为 “从服务器”）。主从复制可用于实现高可用性、负载均衡和数据备份等目的。</p>\n<h1 id=\"步骤\"><a class=\"anchor\" href=\"#步骤\">#</a> 步骤</h1>\n<h2 id=\"主机\"><a class=\"anchor\" href=\"#主机\">#</a> 主机</h2>\n<ol>\n<li>\n<p>使用以下命令登录到 MariaDB：</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql -uroot -p</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li>\n<p>创建一个新的数据库并在其中创建一个新的表：</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">create database db1;</span><br><span class=\"line\">use db1;</span><br><span class=\"line\">create table test1(id int,name char);</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li>\n<p>退出 MariaDB 并停止 MariaDB 服务器：</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">exit;</span><br><span class=\"line\">systemctl stop mariadb</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li>\n<p>使用编辑器打开 MariaDB 的配置文件。在 CentOS 中，配置文件位于  <code>/etc/my.cnf</code> ，而在 Ubuntu 中，配置文件位于  <code>/etc/mysql/mariadb.conf.d/50-server.cnf</code> 。</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/my.cnf   <span class=\"comment\"># CentOS</span></span><br><span class=\"line\">vi /etc/mysql/mariadb.conf.d/50-server.cnf   <span class=\"comment\"># Ubuntu</span></span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li>\n<p>在配置文件中添加以下内容：</p>\n<figure class=\"highlight vim\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\"><span class=\"built_in\">log</span>-bin=/var/<span class=\"built_in\">log</span>/mysql/mysql-bin.<span class=\"built_in\">log</span></span><br><span class=\"line\">server-id=<span class=\"number\">1</span></span><br><span class=\"line\">binlog-<span class=\"keyword\">do</span>-db=db1</span><br><span class=\"line\">bind-address=<span class=\"number\">0.0</span>.<span class=\"number\">0.0</span></span><br></pre></td></tr></tbody></table></figure>\n<p>上述配置文件中的关键配置包括：</p>\n<ul>\n<li><code>log-bin</code> ：指定二进制日志文件的路径和名称。二进制日志文件包含主服务器上进行的所有更改。</li>\n<li><code>server-id</code> ：指定主服务器的唯一标识符。每个服务器必须具有唯一的标识符。</li>\n<li><code>binlog-do-db</code> ：指定要在二进制日志中记录更改的数据库名称。</li>\n<li><code>bind-address</code> ：指定要在哪个 IP 地址上监听连接请求。在本例中，我们将其设置为  <code>0.0.0.0</code> ，以允许从任何 IP 地址连接到主服务器。</li>\n</ul>\n</li>\n<li>\n<p>创建日志文件目录并将其所有权分配给 MySQL 用户：</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /var/log/</span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> mysql</span><br><span class=\"line\"><span class=\"built_in\">cd</span> mysql/</span><br><span class=\"line\"><span class=\"built_in\">touch</span> mysql-bin.log</span><br><span class=\"line\"><span class=\"built_in\">cd</span> ../</span><br><span class=\"line\"><span class=\"built_in\">chown</span> -R mysql:mysql ./mysql/</span><br><span class=\"line\"><span class=\"built_in\">ls</span> -ld /var/log/mysql</span><br><span class=\"line\"><span class=\"built_in\">ls</span> -ld /var/log/mysql/mysql-bin.log</span><br></pre></td></tr></tbody></table></figure>\n<p>上述命令将创建一个名为  <code>mysql-bin.log</code>  的空日志文件，并将其所有权分配给 MySQL 用户。</p>\n</li>\n<li>\n<p>启动 MariaDB 服务器并重新登录到 MariaDB：</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start mariadb</span><br><span class=\"line\">mysql -uroot -p</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li>\n<p>授予从服务器复制权限：</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grant replication slave on *.* to slave@'%' identified by '123456';</span><br><span class=\"line\">exit;</span><br></pre></td></tr></tbody></table></figure>\n<p>上述命令将创建一个名为  <code>slave</code>  的用户，并为其授予复制权限。</p>\n</li>\n<li>\n<p>生成当前数据库的备份：</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart mariadb</span><br><span class=\"line\">mysqldump -uroot -p -A &gt; all1.sql</span><br><span class=\"line\">scp all1.sql 10.1.0.16:/root</span><br></pre></td></tr></tbody></table></figure>\n<p>上述命令将在本地生成一个名为  <code>all1.sql</code>  的数据库备份，并将其复制到远程服务器  <code>10.1.0.16</code>  的  <code>/root</code>  目录中。</p>\n</li>\n</ol>\n<h2 id=\"从机\"><a class=\"anchor\" href=\"#从机\">#</a> 从机</h2>\n<ol>\n<li>\n<p>使用以下命令登录到从服务器：</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql -h 10.1.0.20 -uslave -p123456</span><br><span class=\"line\"><span class=\"built_in\">exit</span></span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li>\n<p>将备份文件还原到从服务器中的 MariaDB：</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /root</span><br><span class=\"line\">mysql -uroot -p &lt; all1.sql</span><br><span class=\"line\">mysql -uroot -p</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li>\n<p>确认已成功复制数据库：</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">show databases;</span><br><span class=\"line\">exit;</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li>\n<p>停止从服务器上的 MariaDB 并编辑其配置文件：</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl stop mariadb</span><br><span class=\"line\">vi /etc/my.cnf   <span class=\"comment\"># CentOS</span></span><br><span class=\"line\">vi /etc/mysql/mariadb.conf.d/50-server.cnf   <span class=\"comment\"># Ubuntu</span></span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li>\n<p>在配置文件中添加以下内容：</p>\n<figure class=\"highlight vim\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">server-id=<span class=\"number\">2</span></span><br></pre></td></tr></tbody></table></figure>\n<p>上述配置文件中的关键配置是  <code>server-id</code> ，它指定从服务器的唯一标识符。</p>\n</li>\n<li>\n<p>启动从服务器上的 MariaDB：</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start mariadb</span><br><span class=\"line\">mysql -uroot -p123456</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li>\n<p>在从服务器上配置主从复制：</p>\n<figure class=\"highlight plaintext\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">change master to master_host='10.1.0.20',master_user='slave',master_password='123456',master_port=3306,master_log_file='mysql-bin.000003',master_log_pos=328,master_connect_retry=10;</span><br><span class=\"line\">startslave;</span><br><span class=\"line\">show slave status \\G;</span><br></pre></td></tr></tbody></table></figure>\n<p>上述命令将从服务器配置为将来自主服务器的更改复制到本地 MariaDB 上。 <code>change master to</code>  命令中的参数包括：</p>\n<ul>\n<li><code>master_host</code> ：指定主服务器的 IP 地址或主机名。</li>\n<li><code>master_user</code> ：指定用于连接到主服务器的用户名。</li>\n<li><code>master_password</code> ：指定用于连接到主服务器的密码。</li>\n<li><code>master_port</code> ：指定主服务器的端口号。</li>\n<li><code>master_log_file</code> ：指定主服务器当前正在使用的二进制日志文件的名称。</li>\n<li><code>master_log_pos</code> ：指定主服务器当前正在使用的二进制日志文件中的位置。</li>\n<li><code>master_connect_retry</code> ：指定从服务器在与主服务器断开连接后尝试重新连接的次数。</li>\n</ul>\n<p>``start slave; <code> 命令将从服务器上的复制进程启动。</code> show slave status \\G;` 命令将显示有关从服务器上的复制进程的详细信息。</p>\n<p>至此，主从复制已经设置完成。主服务器上的更改将自动传播到从服务器上。</p>\n</li>\n</ol>\n",
            "tags": [
                "linux",
                "ubuntu",
                "mariadb"
            ]
        }
    ]
}