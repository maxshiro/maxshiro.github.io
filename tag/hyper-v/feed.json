{
    "version": "https://jsonfeed.org/version/1",
    "title": "MAXshiro • All posts by \"hyper-v\" tag",
    "description": "Discover and Record the world.",
    "home_page_url": "http://maxshiroi.top",
    "items": [
        {
            "id": "http://maxshiroi.top/ug/082913/",
            "url": "http://maxshiroi.top/ug/082913/",
            "title": "WSL2迁移以及空间回收。",
            "date_published": "2022-11-19T00:29:13.000Z",
            "content_html": "<div class=\"tag-plugin image\"><div class=\"image-bg\"><img src=\"../img/wsl2move/20221119083153.png\" fancybox=\"true\"></div></div>  \n<h1 id=\"intro\"><a class=\"anchor\" href=\"#intro\">#</a> Intro</h1>\n<p>如果你按照正常方式在设置里移动 wsl 的话就会发现报错，本篇文章向您介绍如何正确迁移以及回收空间。</p>\n<h1 id=\"移动\"><a class=\"anchor\" href=\"#移动\">#</a> 移动</h1>\n<p>在 Windows 的 PowerShell 中输入:</p>\n<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl --<span class=\"built_in\">help</span></span><br></pre></td></tr></tbody></table></figure>\n<p>可以看到关于这个命令的使用帮助说明：</p>\n<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">用法: wsl.exe [参数] [选项...] [命令行]</span><br><span class=\"line\"> </span><br><span class=\"line\">用于运行 Linux 二进制文件的参数:</span><br><span class=\"line\"> </span><br><span class=\"line\">    如果未提供命令行，wsl.exe 将启动默认的 shell。</span><br><span class=\"line\">    --exec, -e &lt;命令行&gt;</span><br><span class=\"line\">        执行指定的命令而不使用默认的 Linux shell。</span><br><span class=\"line\">    --</span><br><span class=\"line\">        按原样传递剩余的命令行。</span><br><span class=\"line\">选项:</span><br><span class=\"line\">    --distribution, -d &lt;分发版&gt;</span><br><span class=\"line\">        运行指定的分发。</span><br><span class=\"line\">    --user, -u &lt;用户名&gt;</span><br><span class=\"line\">        以指定用户身份运行。</span><br><span class=\"line\">用于管理适用于 Linux 的 Windows 子系统的参数:</span><br><span class=\"line\"> </span><br><span class=\"line\">    --export &lt;分发版&gt; &lt;文件名&gt;</span><br><span class=\"line\">        将分发导出到 tar 文件。</span><br><span class=\"line\">        对于标准输出，文件名可以是 -。</span><br><span class=\"line\">    --import &lt;分发版&gt; &lt;安装位置&gt; &lt;文件名&gt; [选项]</span><br><span class=\"line\">        将指定的 tar 文件作为新分发进行导入。</span><br><span class=\"line\">        对于标准输入，文件名可以是 -。</span><br><span class=\"line\">        选项:</span><br><span class=\"line\">            --version &lt;版本&gt;</span><br><span class=\"line\">                指定用于新分发的版本。</span><br><span class=\"line\">    --list, -l [选项]</span><br><span class=\"line\">        列出分发。</span><br><span class=\"line\">        选项:</span><br><span class=\"line\">            --all</span><br><span class=\"line\">                列出所有分发，包括当前正在</span><br><span class=\"line\">                安装或卸载的分发。</span><br><span class=\"line\">            --running</span><br><span class=\"line\">                只列出当前正在运行的分发。</span><br><span class=\"line\">            --quiet, -q</span><br><span class=\"line\">                只显示分发名称。</span><br><span class=\"line\">            --verbose, -v</span><br><span class=\"line\">                显示有关所有分发的详细信息。</span><br><span class=\"line\">    --<span class=\"built_in\">set</span>-default, -s &lt;分发版&gt;</span><br><span class=\"line\">        将分发设置为默认值。</span><br><span class=\"line\">    --<span class=\"built_in\">set</span>-default-version &lt;版本&gt;</span><br><span class=\"line\">        更改新分发的默认安装版本。</span><br><span class=\"line\">    --<span class=\"built_in\">set</span>-version &lt;分发版&gt; &lt;版本&gt;</span><br><span class=\"line\">        更改指定分发的版本。</span><br><span class=\"line\">    --shutdown</span><br><span class=\"line\">        立即终止所有正在运行的分发和 WSL <span class=\"number\">2</span> 轻型工具虚拟机。</span><br><span class=\"line\">    --terminate, -t &lt;分发版&gt;</span><br><span class=\"line\">        终止指定的分发。</span><br><span class=\"line\">    --unregister &lt;分发版&gt;</span><br><span class=\"line\">        注销分发。</span><br><span class=\"line\">    --<span class=\"built_in\">help</span></span><br><span class=\"line\">        显示用法信息。</span><br></pre></td></tr></tbody></table></figure>\n<p>这里我们使用到 export 、unregister 和 import 几个选项就可以实现迁移。</p>\n<ol>\n<li>终止正在运行的分发或虚拟机：<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl --shutdown</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li>查看已安装的 wsl 名称：<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl.exe --list --all</span><br></pre></td></tr></tbody></table></figure>\n<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">适用于 Linux 的 Windows 子系统分发:</span><br><span class=\"line\">Debian (默认)</span><br><span class=\"line\">kali-linux</span><br><span class=\"line\">Ubuntu</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li>对需要迁移的分发或虚拟机导出（我要迁移 kali-linux）：<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl --export kali-linux D:\\kali</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li>卸载分发版或虚拟机（如果是要重装系统或换机器安装，这一步可以省略，但是要将上一步导出的文件保存好）<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl --unregister kali-linux</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li>导入新的分发版或虚拟机：<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl --import kali-linux D:\\wsl\\kali D:\\kali</span><br></pre></td></tr></tbody></table></figure>\n</li>\n</ol>\n<h1 id=\"压缩\"><a class=\"anchor\" href=\"#压缩\">#</a> 压缩</h1>\n<p>等待导入后你会发现移动的其实是 vhdx 文件，那么就可以对这个文件进行回收空间。</p>\n<ol>\n<li>以管理员身份运行 cmd，输入 diskpart 命令按回车。</li>\n<li>使用以下命令选择你的 userdata.vhdx</li>\n</ol>\n<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select vdisk file = \"D:\\wsl\\ext4.vhdx\"</span><br></pre></td></tr></tbody></table></figure>\n<p>如果提示</p>\n<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DiskPart successfully selected the virtual disk file.</span><br></pre></td></tr></tbody></table></figure>\n<p>就说明成功了。</p>\n<ol start=\"3\">\n<li>输入  <code>compact vdisk</code>  来压缩。</li>\n</ol>\n<h1 id=\"bug\"><a class=\"anchor\" href=\"#bug\">#</a> bug</h1>\n<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">ERROR: <span class=\"title\">Wsl</span>/<span class=\"title\">Service</span>/<span class=\"title\">CreateInstance</span>/<span class=\"title\">ERROR_FILE_NOT_FOUND</span></span></span><br></pre></td></tr></tbody></table></figure>\n<p>打开命令行，在命令行中输入</p>\n<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl.exe --list --all</span><br><span class=\"line\">wsl.exe --unregister xxx</span><br></pre></td></tr></tbody></table></figure>\n<h1 id=\"摘抄\"><a class=\"anchor\" href=\"#摘抄\">#</a> 摘抄</h1>\n<p><a href=\"https://blog.csdn.net/zhys2007/article/details/110958577\">WSL2 迁移方法</a><br>\n<a href=\"https://blog.csdn.net/y17854117512/article/details/119214442?spm=1001.2101.3001.6661.1&amp;utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1-119214442-blog-110900591.pc_relevant_default&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1-119214442-blog-110900591.pc_relevant_default&amp;utm_relevant_index=1\">解决 Win10 子系统的 Ubuntu 被删除后，重新安装出现找不到系统路径</a></p>\n",
            "tags": [
                "linux",
                "wsl2",
                "Hyper-v"
            ]
        },
        {
            "id": "http://maxshiroi.top/ug/205944/",
            "url": "http://maxshiroi.top/ug/205944/",
            "title": "Win11 安装 WSA 简易教程",
            "date_published": "2022-08-28T12:59:44.000Z",
            "content_html": "<blockquote>\n<p>微软终于在昨天上线了 WSA 的测试版本，此次只有美国地区上线了。因此如果你的 Win11 系统为美区的话，可以直接点击 <a href=\"https://www.microsoft.com/store/productId/9P3395VX91NR\" title=\"这个链接\">这个链接</a> 进行安装。如果非美区那就接着看步骤吧</p>\n</blockquote>\n<blockquote>\n<p>bug 还是有很多，首先是 WSA 无法调用 GPU, 这就导致很多 3d 游戏会很卡，实测明日方舟帧数不到 20 帧。然后安装 WSA 要启用 Hyper-V 即微软的虚拟机平台，打开这个会导致无法再安装和使用其他安卓模拟器。和市面上大多数安卓模拟器相比，微软这个 WSA 是 ARM 翻译运行的，安卓版本更高 (Android 11), 可以运行 ARM 程序。与系统集成度更好 (虽然目前还没有实现 WSL 那样的文件访问) 而模拟器大多都为 Android x86 项目改的，因此最高只能到 Android 9.</p>\n</blockquote>\n<blockquote>\n<p>如果你是想尝尝鲜，试试这个新功能那我还是推荐试一试。如果你主要想拿来打游戏，日常使用的话那还是更推荐安卓模拟器一些.</p>\n</blockquote>\n<h1 id=\"开启虚拟化\"><a class=\"anchor\" href=\"#开启虚拟化\">#</a> 开启虚拟化</h1>\n<blockquote>\n<p>PS: 如果之前你有禁用过 Hyper-V 的话记得使用管理员权限打开 Powershell 然后通过这个指令这个指令重新打开，不记得有没有那就跳过:</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bcdedit /set hypervisorlaunchtype auto</span><br></pre></td></tr></tbody></table></figure>\n<ol>\n<li>打开开始菜单，直接搜索控制面板，然后打开.</li>\n<li>找到  <code>程序和功能</code>  - <code>启用或关闭 Windows 功能</code>  并点击打开，会弹出一个窗口.</li>\n<li>在弹出窗口里面勾选  <code>Hyper-V</code> 、 <code>Windows 虚拟机监控程序平台</code> 、 <code>适用于 Linux 的 Windows 子系统</code> 、 <code>虚拟机平台</code>  这几项，然后点击确定。系统会自动查找更新并安装.</li>\n<li>等待重启过后就可以进行下一步了.</li>\n</ol>\n<h1 id=\"安装本体\"><a class=\"anchor\" href=\"#安装本体\">#</a> 安装本体</h1>\n<ol>\n<li>首先复制上面那个链接.</li>\n<li><a href=\"https://store.rg-adguard.net/\" title=\"安装包抓包\">安装包抓包</a>，点开这个网址，将第一步复制的链接粘贴到搜索框，右边选择  <code>slow</code>  然后点对勾.</li>\n<li>找到最下面名为  <code>MicrosoftCorporationII.WindowsSubsystemForAndroid_1.7.32815.0_neutral_~_8wekyb3d8bbwe.msixbundle</code>  的一项，注意大小为  <code>1.21GB</code>  , 直接点击进行一个下载.</li>\n<li>找到你下载的文件，然后右键  <code>开始按钮</code>  选择  <code>Windows 终端 (管理员)</code></li>\n<li>然后会打开 Powershell 窗口，在里面输入指令</li>\n</ol>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">add-appxpackage <span class=\"string\">\"你下载文件的完整路径\"</span> </span><br><span class=\"line\"><span class=\"comment\"># example</span></span><br><span class=\"line\">add-appxpackage <span class=\"string\">\"D:\\download\\MicrosoftCorporationII.WindowsSubsystemForAndroid_1.7.32815.0_neutral_~_8wekyb3d8bbwe.msixbundle\"</span></span><br></pre></td></tr></tbody></table></figure>\n<ol start=\"6\">\n<li>等他跑完以后就会在开始菜单里出现  <code>Windows Subsystem for Android™</code>  点击打开是下面这个界面就说明安装成功了.</li>\n</ol>\n<div class=\"tag-plugin image\"><div class=\"image-bg\"><img src=\"/img/wsa/20220920220234.png\" fancybox=\"true\"></div></div>  \n<h1 id=\"安装apk\"><a class=\"anchor\" href=\"#安装apk\">#</a> 安装 apk</h1>\n<ol>\n<li>点击文件后面的按钮会自动启动 WSA, 等打开后下面的 ip 地址会刷新。此时我们将开发人员模式打开.</li>\n<li>安装 ADB, 下载 <a href=\"https://nas.axro.top/index.php/s/frYxCHg7FfabNEY\" title=\"这个文件\">这个文件</a> 然后解压到任意目录，然后打开解压出来的文件夹，名称为  <code>platform-tools</code> .</li>\n<li>按住 <code>Shift</code>  键右击文件夹的空白处，选择 <code>显示更多选项</code>  - <code>在此处打开 Powershell 窗口(s)</code> , 然后在打开的窗口内依次输入以下指令:</li>\n</ol>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">adb connect 127.0.0.1:58526 <span class=\"comment\">#这个 127.0.0.1:58526 为你的开发人员选项那一栏里显示的地址.</span></span><br><span class=\"line\"><span class=\"comment\"># 第一次可能会失败, 再输入一次就可以了.</span></span><br><span class=\"line\">adb install -r xxx.apk</span><br><span class=\"line\"><span class=\"comment\"># 这个指令为安装 apk, 将 xxx 替换为你要安装的 apk 文件名称.</span></span><br></pre></td></tr></tbody></table></figure>\n<ol start=\"4\">\n<li>显示安装完成就会出现在你的开始菜单里，然后直接点击进行一个打开.</li>\n</ol>\n<h1 id=\"qa\"><a class=\"anchor\" href=\"#qa\">#</a> Q&amp;A</h1>\n",
            "tags": [
                "Android",
                "Hyper-V",
                "WSA"
            ]
        }
    ]
}