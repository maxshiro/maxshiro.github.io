{
    "version": "https://jsonfeed.org/version/1",
    "title": "MAXshiro's Blog • All posts by \"wsl2\" tag",
    "description": "Discover and Record the world.",
    "home_page_url": "http://maxshiroi.top",
    "items": [
        {
            "id": "http://maxshiroi.top/ug/082913/",
            "url": "http://maxshiroi.top/ug/082913/",
            "title": "WSL2迁移以及空间回收。",
            "date_published": "2022-11-19T00:29:13.000Z",
            "content_html": "<p><img src=\"../img/wsl2move/20221119083153.png\" alt=\"\"></p>\n<h1 id=\"intro\"><a class=\"markdownIt-Anchor\" href=\"#intro\">#</a> Intro</h1>\n<p>如果你按照正常方式在设置里移动 wsl 的话就会发现报错，本篇文章向您介绍如何正确迁移以及回收空间。</p>\n<h1 id=\"移动\"><a class=\"markdownIt-Anchor\" href=\"#移动\">#</a> 移动</h1>\n<p>在 Windows 的 PowerShell 中输入:</p>\n<pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><div class=\"caption\"><span>cmd</span></div><code class=\"language-cmd\">wsl --help<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>可以看到关于这个命令的使用帮助说明：</p>\n<pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><div class=\"caption\"><span>cmd</span></div><code class=\"language-cmd\">用法: wsl.exe [参数] [选项...] [命令行]\n \n用于运行 Linux 二进制文件的参数:\n \n    如果未提供命令行，wsl.exe 将启动默认的 shell。\n    --exec, -e &lt;命令行&gt;\n        执行指定的命令而不使用默认的 Linux shell。\n    --\n        按原样传递剩余的命令行。\n选项:\n    --distribution, -d &lt;分发版&gt;\n        运行指定的分发。\n    --user, -u &lt;用户名&gt;\n        以指定用户身份运行。\n用于管理适用于 Linux 的 Windows 子系统的参数:\n \n    --export &lt;分发版&gt; &lt;文件名&gt;\n        将分发导出到 tar 文件。\n        对于标准输出，文件名可以是 -。\n    --import &lt;分发版&gt; &lt;安装位置&gt; &lt;文件名&gt; [选项]\n        将指定的 tar 文件作为新分发进行导入。\n        对于标准输入，文件名可以是 -。\n        选项:\n            --version &lt;版本&gt;\n                指定用于新分发的版本。\n    --list, -l [选项]\n        列出分发。\n        选项:\n            --all\n                列出所有分发，包括当前正在\n                安装或卸载的分发。\n            --running\n                只列出当前正在运行的分发。\n            --quiet, -q\n                只显示分发名称。\n            --verbose, -v\n                显示有关所有分发的详细信息。\n    --set-default, -s &lt;分发版&gt;\n        将分发设置为默认值。\n    --set-default-version &lt;版本&gt;\n        更改新分发的默认安装版本。\n    --set-version &lt;分发版&gt; &lt;版本&gt;\n        更改指定分发的版本。\n    --shutdown\n        立即终止所有正在运行的分发和 WSL 2 轻型工具虚拟机。\n    --terminate, -t &lt;分发版&gt;\n        终止指定的分发。\n    --unregister &lt;分发版&gt;\n        注销分发。\n    --help\n        显示用法信息。<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>这里我们使用到 export 、unregister 和 import 几个选项就可以实现迁移。</p>\n<ol>\n<li>终止正在运行的分发或虚拟机：<pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><div class=\"caption\"><span>cmd</span></div><code class=\"language-cmd\">wsl --shutdown<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n<li>查看已安装的 wsl 名称：<pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><div class=\"caption\"><span>cmd</span></div><code class=\"language-cmd\">wsl.exe --list --all<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><div class=\"caption\"><span>cmd</span></div><code class=\"language-cmd\">适用于 Linux 的 Windows 子系统分发:\nDebian (默认)\nkali-linux\nUbuntu<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n<li>对需要迁移的分发或虚拟机导出（我要迁移 kali-linux）：<pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><div class=\"caption\"><span>cmd</span></div><code class=\"language-cmd\">wsl --export kali-linux D:\\kali<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n<li>卸载分发版或虚拟机（如果是要重装系统或换机器安装，这一步可以省略，但是要将上一步导出的文件保存好）<pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><div class=\"caption\"><span>cmd</span></div><code class=\"language-cmd\">wsl --unregister kali-linux<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n<li>导入新的分发版或虚拟机：<pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><div class=\"caption\"><span>cmd</span></div><code class=\"language-cmd\">wsl --import kali-linux D:\\wsl\\kali D:\\kali<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n</ol>\n<h1 id=\"压缩\"><a class=\"markdownIt-Anchor\" href=\"#压缩\">#</a> 压缩</h1>\n<p>等待导入后你会发现移动的其实是 vhdx 文件，那么就可以对这个文件进行回收空间。</p>\n<ol>\n<li>以管理员身份运行 cmd，输入 diskpart 命令按回车。</li>\n<li>使用以下命令选择你的 userdata.vhdx</li>\n</ol>\n<pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><div class=\"caption\"><span>cmd</span></div><code class=\"language-cmd\">select vdisk file = \"D:\\wsl\\ext4.vhdx\"<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>如果提示</p>\n<pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><div class=\"caption\"><span>cmd</span></div><code class=\"language-cmd\">DiskPart successfully selected the virtual disk file.<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>就说明成功了。</p>\n<ol start=\"3\">\n<li>输入  <code>compact vdisk</code>  来压缩。</li>\n</ol>\n<h1 id=\"bug\"><a class=\"markdownIt-Anchor\" href=\"#bug\">#</a> bug</h1>\n<pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><div class=\"caption\"><span>cmd</span></div><code class=\"language-cmd\">ERROR: Wsl/Service/CreateInstance/ERROR_FILE_NOT_FOUND<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>打开命令行，在命令行中输入</p>\n<pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><div class=\"caption\"><span>cmd</span></div><code class=\"language-cmd\">wsl.exe --list --all\nwsl.exe --unregister xxx<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h1 id=\"摘抄\"><a class=\"markdownIt-Anchor\" href=\"#摘抄\">#</a> 摘抄</h1>\n<p><a href=\"https://blog.csdn.net/zhys2007/article/details/110958577\">WSL2 迁移方法</a><br>\n<a href=\"https://blog.csdn.net/y17854117512/article/details/119214442?spm=1001.2101.3001.6661.1&amp;utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1-119214442-blog-110900591.pc_relevant_default&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1-119214442-blog-110900591.pc_relevant_default&amp;utm_relevant_index=1\">解决 Win10 子系统的 Ubuntu 被删除后，重新安装出现找不到系统路径</a></p>\n",
            "tags": [
                "linux",
                "wsl2",
                "Hyper-v"
            ]
        }
    ]
}