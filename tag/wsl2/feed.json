{
    "version": "https://jsonfeed.org/version/1",
    "title": "MAXshiro • All posts by \"wsl2\" tag",
    "description": "Discover and Record the world.",
    "home_page_url": "http://maxshiroi.top",
    "items": [
        {
            "id": "http://maxshiroi.top/ug/082913/",
            "url": "http://maxshiroi.top/ug/082913/",
            "title": "WSL2迁移以及空间回收。",
            "date_published": "2022-11-19T00:29:13.000Z",
            "content_html": "<div class=\"tag-plugin image\"><div class=\"image-bg\"><img src=\"../img/wsl2move/20221119083153.png\" fancybox=\"true\"></div></div>  \n<h1 id=\"intro\"><a class=\"anchor\" href=\"#intro\">#</a> Intro</h1>\n<p>如果你按照正常方式在设置里移动 wsl 的话就会发现报错，本篇文章向您介绍如何正确迁移以及回收空间。</p>\n<h1 id=\"移动\"><a class=\"anchor\" href=\"#移动\">#</a> 移动</h1>\n<p>在 Windows 的 PowerShell 中输入:</p>\n<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl --<span class=\"built_in\">help</span></span><br></pre></td></tr></tbody></table></figure>\n<p>可以看到关于这个命令的使用帮助说明：</p>\n<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">用法: wsl.exe [参数] [选项...] [命令行]</span><br><span class=\"line\"> </span><br><span class=\"line\">用于运行 Linux 二进制文件的参数:</span><br><span class=\"line\"> </span><br><span class=\"line\">    如果未提供命令行，wsl.exe 将启动默认的 shell。</span><br><span class=\"line\">    --exec, -e &lt;命令行&gt;</span><br><span class=\"line\">        执行指定的命令而不使用默认的 Linux shell。</span><br><span class=\"line\">    --</span><br><span class=\"line\">        按原样传递剩余的命令行。</span><br><span class=\"line\">选项:</span><br><span class=\"line\">    --distribution, -d &lt;分发版&gt;</span><br><span class=\"line\">        运行指定的分发。</span><br><span class=\"line\">    --user, -u &lt;用户名&gt;</span><br><span class=\"line\">        以指定用户身份运行。</span><br><span class=\"line\">用于管理适用于 Linux 的 Windows 子系统的参数:</span><br><span class=\"line\"> </span><br><span class=\"line\">    --export &lt;分发版&gt; &lt;文件名&gt;</span><br><span class=\"line\">        将分发导出到 tar 文件。</span><br><span class=\"line\">        对于标准输出，文件名可以是 -。</span><br><span class=\"line\">    --import &lt;分发版&gt; &lt;安装位置&gt; &lt;文件名&gt; [选项]</span><br><span class=\"line\">        将指定的 tar 文件作为新分发进行导入。</span><br><span class=\"line\">        对于标准输入，文件名可以是 -。</span><br><span class=\"line\">        选项:</span><br><span class=\"line\">            --version &lt;版本&gt;</span><br><span class=\"line\">                指定用于新分发的版本。</span><br><span class=\"line\">    --list, -l [选项]</span><br><span class=\"line\">        列出分发。</span><br><span class=\"line\">        选项:</span><br><span class=\"line\">            --all</span><br><span class=\"line\">                列出所有分发，包括当前正在</span><br><span class=\"line\">                安装或卸载的分发。</span><br><span class=\"line\">            --running</span><br><span class=\"line\">                只列出当前正在运行的分发。</span><br><span class=\"line\">            --quiet, -q</span><br><span class=\"line\">                只显示分发名称。</span><br><span class=\"line\">            --verbose, -v</span><br><span class=\"line\">                显示有关所有分发的详细信息。</span><br><span class=\"line\">    --<span class=\"built_in\">set</span>-default, -s &lt;分发版&gt;</span><br><span class=\"line\">        将分发设置为默认值。</span><br><span class=\"line\">    --<span class=\"built_in\">set</span>-default-version &lt;版本&gt;</span><br><span class=\"line\">        更改新分发的默认安装版本。</span><br><span class=\"line\">    --<span class=\"built_in\">set</span>-version &lt;分发版&gt; &lt;版本&gt;</span><br><span class=\"line\">        更改指定分发的版本。</span><br><span class=\"line\">    --shutdown</span><br><span class=\"line\">        立即终止所有正在运行的分发和 WSL <span class=\"number\">2</span> 轻型工具虚拟机。</span><br><span class=\"line\">    --terminate, -t &lt;分发版&gt;</span><br><span class=\"line\">        终止指定的分发。</span><br><span class=\"line\">    --unregister &lt;分发版&gt;</span><br><span class=\"line\">        注销分发。</span><br><span class=\"line\">    --<span class=\"built_in\">help</span></span><br><span class=\"line\">        显示用法信息。</span><br></pre></td></tr></tbody></table></figure>\n<p>这里我们使用到 export 、unregister 和 import 几个选项就可以实现迁移。</p>\n<ol>\n<li>终止正在运行的分发或虚拟机：<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl --shutdown</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li>查看已安装的 wsl 名称：<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl.exe --list --all</span><br></pre></td></tr></tbody></table></figure>\n<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">适用于 Linux 的 Windows 子系统分发:</span><br><span class=\"line\">Debian (默认)</span><br><span class=\"line\">kali-linux</span><br><span class=\"line\">Ubuntu</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li>对需要迁移的分发或虚拟机导出（我要迁移 kali-linux）：<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl --export kali-linux D:\\kali</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li>卸载分发版或虚拟机（如果是要重装系统或换机器安装，这一步可以省略，但是要将上一步导出的文件保存好）<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl --unregister kali-linux</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li>导入新的分发版或虚拟机：<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl --import kali-linux D:\\wsl\\kali D:\\kali</span><br></pre></td></tr></tbody></table></figure>\n</li>\n</ol>\n<h1 id=\"压缩\"><a class=\"anchor\" href=\"#压缩\">#</a> 压缩</h1>\n<p>等待导入后你会发现移动的其实是 vhdx 文件，那么就可以对这个文件进行回收空间。</p>\n<ol>\n<li>以管理员身份运行 cmd，输入 diskpart 命令按回车。</li>\n<li>使用以下命令选择你的 userdata.vhdx</li>\n</ol>\n<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select vdisk file = \"D:\\wsl\\ext4.vhdx\"</span><br></pre></td></tr></tbody></table></figure>\n<p>如果提示</p>\n<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DiskPart successfully selected the virtual disk file.</span><br></pre></td></tr></tbody></table></figure>\n<p>就说明成功了。</p>\n<ol start=\"3\">\n<li>输入  <code>compact vdisk</code>  来压缩。</li>\n</ol>\n<h1 id=\"bug\"><a class=\"anchor\" href=\"#bug\">#</a> bug</h1>\n<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">ERROR: <span class=\"title\">Wsl</span>/<span class=\"title\">Service</span>/<span class=\"title\">CreateInstance</span>/<span class=\"title\">ERROR_FILE_NOT_FOUND</span></span></span><br></pre></td></tr></tbody></table></figure>\n<p>打开命令行，在命令行中输入</p>\n<figure class=\"highlight cmd\"><figcaption><span>cmd</span></figcaption><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl.exe --list --all</span><br><span class=\"line\">wsl.exe --unregister xxx</span><br></pre></td></tr></tbody></table></figure>\n<h1 id=\"摘抄\"><a class=\"anchor\" href=\"#摘抄\">#</a> 摘抄</h1>\n<p><a href=\"https://blog.csdn.net/zhys2007/article/details/110958577\">WSL2 迁移方法</a><br>\n<a href=\"https://blog.csdn.net/y17854117512/article/details/119214442?spm=1001.2101.3001.6661.1&amp;utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1-119214442-blog-110900591.pc_relevant_default&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1-119214442-blog-110900591.pc_relevant_default&amp;utm_relevant_index=1\">解决 Win10 子系统的 Ubuntu 被删除后，重新安装出现找不到系统路径</a></p>\n",
            "tags": [
                "linux",
                "wsl2",
                "Hyper-v"
            ]
        }
    ]
}