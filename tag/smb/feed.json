{
    "version": "https://jsonfeed.org/version/1",
    "title": "MAXshiro • All posts by \"smb\" tag",
    "description": "Discover and Record the world.",
    "home_page_url": "http://maxshiroi.top",
    "items": [
        {
            "id": "http://maxshiroi.top/ug/211502/",
            "url": "http://maxshiroi.top/ug/211502/",
            "title": "解决linux下挂载其他linux硬盘的问题并创建smb局域网共享",
            "date_published": "2022-08-28T13:15:02.000Z",
            "content_html": "<h1 id=\"intro\"><a class=\"anchor\" href=\"#intro\">#</a> Intro</h1>\n<blockquote>\n<p>之前用来当作小型服务器的笔记本终于被我给淘汰了。已经关机了好久。最近买了块 <code>SATA</code>  硬盘盒，想要将这台笔记本内的数据备份出来并把硬盘用作其他用途。一切连接好后发现无法挂载，遂百度了一会查出了如下方法...</p>\n</blockquote>\n<h1 id=\"故障复现\"><a class=\"anchor\" href=\"#故障复现\">#</a> 故障复现</h1>\n<ol>\n<li>连接 linux 系统，提示插入硬盘. <code>/dev</code>  分区下出现硬盘编号</li>\n<li>执行如下指令</li>\n</ol>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /</span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> backup</span><br><span class=\"line\">mount /dev/sdc/ /backup/</span><br></pre></td></tr></tbody></table></figure>\n<p>报错</p>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mount: unknown filesystem <span class=\"built_in\">type</span> <span class=\"string\">'LVM2_member'</span></span><br></pre></td></tr></tbody></table></figure>\n<h1 id=\"解决方法-debian系\"><a class=\"anchor\" href=\"#解决方法-debian系\">#</a> 解决方法 //Debian 系</h1>\n<ol>\n<li>执行如下指令安装 lvm2 并扫描查看以挂载的磁盘</li>\n</ol>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install lvm2</span><br><span class=\"line\">sudo vgscan</span><br></pre></td></tr></tbody></table></figure>\n<ol start=\"2\">\n<li>发现如下字样后找到对应的 <code>xxx</code></li>\n</ol>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Found volume group <span class=\"string\">\"xxx\"</span> using metadata <span class=\"built_in\">type</span> lvm2</span><br></pre></td></tr></tbody></table></figure>\n<ol start=\"3\">\n<li>设为活动状态并查看可挂载的分区</li>\n</ol>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vgchange -ay xxx</span><br><span class=\"line\">sudo lvs</span><br><span class=\"line\">LV     VG   Attr   LSize  Origin Snap%  Move Log Copy%  Convert</span><br><span class=\"line\">data        xxx             -wi-a-              34.19G      </span><br></pre></td></tr></tbody></table></figure>\n<ol start=\"4\">\n<li>挂载对应分区</li>\n</ol>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mount /dev/xxx/data/ /backup/</span><br></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>至此已经解决了问题，如果你还想把这块硬盘里的数据共享出去，比如共享给局域网内的 windows 主机，那就接着看..</p>\n</blockquote>\n<h1 id=\"设置smb\"><a class=\"anchor\" href=\"#设置smb\">#</a> 设置 SMB</h1>\n<ol>\n<li>先更新一下</li>\n</ol>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update &amp;&amp; sudo apt-get upgrade</span><br></pre></td></tr></tbody></table></figure>\n<ol start=\"2\">\n<li>安装 Samba 服务</li>\n</ol>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install samba samba-common</span><br></pre></td></tr></tbody></table></figure>\n<ol start=\"3\">\n<li>配置共享目录</li>\n</ol>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 新建目录</span><br><span class=\"line\">sudo <span class=\"built_in\">mkdir</span> /home/db</span><br><span class=\"line\">// 更改目录权限</span><br><span class=\"line\">sudo <span class=\"built_in\">chmod</span> 777 /home/db/ -R</span><br></pre></td></tr></tbody></table></figure>\n<ol start=\"4\">\n<li>添加账户</li>\n</ol>\n<blockquote>\n<p>要注意添加的账户需要是系统内已存在的账户</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 后面的pi为系统的用户名</span><br><span class=\"line\">sudo smbpasswd -a pi</span><br></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>输入两次密码后创建成功</p>\n</blockquote>\n<ul>\n<li>创建系统账户</li>\n</ul>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// -m参数为添加/home/username目录,username更改为你要创建的用户名.</span><br><span class=\"line\">sudo useradd -m username</span><br><span class=\"line\">// 更改账户密码</span><br><span class=\"line\">sudo passwd username</span><br><span class=\"line\">// 删除用户</span><br><span class=\"line\">sudo userdel -r username</span><br><span class=\"line\">// 更改登录zhanghu</span><br><span class=\"line\">su -username</span><br></pre></td></tr></tbody></table></figure>\n<ol start=\"5\">\n<li>配置 samba</li>\n</ol>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 建议先备份一下</span><br><span class=\"line\">sudo <span class=\"built_in\">cp</span> /etc/samba/smb.conf /etc/samba/smb.conf.bak</span><br><span class=\"line\">// 编辑</span><br><span class=\"line\">sudo vim /etc/samba/smb.conf</span><br></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>在文件最后添加</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[database] </span><br><span class=\"line\">    comment = 23333333  <span class=\"comment\"># 描述</span></span><br><span class=\"line\">\tpath = /home/db/    <span class=\"comment\"># 目录</span></span><br><span class=\"line\">\tpublic = <span class=\"built_in\">yes</span>        <span class=\"comment\"># 是否允许guest用户访问</span></span><br><span class=\"line\">\twritable = <span class=\"built_in\">yes</span>      <span class=\"comment\"># 是否允许读写</span></span><br><span class=\"line\">\tworkgroup = WORKGROUP  <span class=\"comment\"># 工作组</span></span><br></pre></td></tr></tbody></table></figure>\n<ol start=\"6\">\n<li>重启 samba 服务</li>\n</ol>\n<figure class=\"highlight bash\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo service smbd restart</span><br></pre></td></tr></tbody></table></figure>\n<p>然后在 windows 里面映射就行了</p>\n<h1 id=\"借鉴摘抄\"><a class=\"anchor\" href=\"#借鉴摘抄\">#</a> 借鉴 (摘抄)</h1>\n<p><a href=\"https://blog.csdn.net/mvp_Dawn/article/details/105847485\" title=\"ubuntu 20.04 安装配置Samba服务，Windows 和 linux协同工作\">ubuntu 20.04 安装配置 Samba 服务，Windows 和 linux 协同工作</a></p>\n",
            "tags": [
                "linux",
                "运维",
                "smb"
            ]
        }
    ]
}